---
layout: default
title: Working with files
license: https://github.com/DavidKendall/blinky/blob/master/LICENSE
---

## Introduction
Two guides to C are

[The C Book](assets/ra/thecbook.pdf)
: A thorough guide to C, it takes you through all the important features.

[Essential C](assets/ra/EssentialC.pdf)
: A shorter summary of C

### Install additional packages
You will need some extra resources for parts of these exercises.

```
 sudo apt install gnuplot
```

### Clone the repository
```
git clone https://github.com/dr-alun-moon/kv5002_L06
```
change the working directory
```
cd kv5002_L06
```

## Simple formatted output

The program `trigtable.c` is a skeleton program that prints out a table of 
trigonometric functions.

1. Compile the program
	```
	cc -o trigtable  trigtable.c -lm 
	```

2. Run the program, supplying a filename to write to 
	```
	./trigtable trig.data
	```

3. Run the supplied script
	```
	gnuplot -p -c trig.plt trig.data1
	```

### Exercise: Extend the Table
1. Add additional fields to the `fprintf` function to print out cosine values
`cos(radians)`

2. Rerun and Plot the data
	```
	./trigtable trig.data
	gnuplot -p -c trig.plt trig.data 2
	```
3. Plot the data
	```
	gnuplot -p -c shm.plt trig.data
	```
	_You should get a circle_

4. Add a print statement before the loop to print out some column names
	```
	fprintf(output,"angle    sin   cos \n")
	```
5. Rerun and plot the data
	```
	./trigtable trig.data
	gnuplot -p -c trig.plt trig.data 2
	```
6. If you're confident try adding other columns to the output.
7. When plotting the data file, the number is the number of columns
   after the angle column.
	```
	gnuplot -p -c trig.plt 3
	```

## Network Monitoring
The files  `/sys/class/net/eno1/statistics/rx_bytes` and
`/sys/class/net/eno1/statistics/tx_bytes` show the cumulative data
transferred via the network interface.  The value from the file can be read
using 

```c
unsigned long data;
fscanf( file, "%lu", &data);
```


1. Write a function that opens these two files, reads in the received bytes
   (rx) and transmitted bytes (tx).  Return these as a structure
	```c
	struct xfer {
		unsigned long rx, tx;
	};
    ```
2. Call this function from main and print out a row of transmitted and
   received bytes.

3. Call this repeatedly from main (in a loop) to log network traffic.
   (You may want to try downloading a file from somewhere to generate some
	traffic.)

4. Save the last read value, and then calculate the difference between this
   and the new value to get an estimate of the data rate.   Print out the
	rates  instead of the total values.

> You will have to decide on your own sample rate to use, and the value to use
> in `usleep`

5. You can plot the results by saving the output in a file `xfer.data` and
   using (If you add a first line with the strings `"rx"` and `"tx"` you will
get labels for the curves
	```
	gnuplot -p -c xfer.plt xfer.data
	```

## Line oriented reading
`fscanf`  doesn't pay any attention to line endings.  
If we want to read a file line-by-line we need to use `fgets`
(see `man fgets`)

The file `memparse.c` reads a file formatted as _key_:_value_ pairs.
You will want to read through the description of `strtok` to understand its
usage here.

1. Compile and run the program
2. Modify main to repreatedly call the function that reads the meminfo file.
3. Look at the contents of /proc/meminfo and add additional fields to be read and reported.
4. Add column headings with the names of the fields.
5. This can be plotted with (the number is the number of fields to use)
    ```
     gnuplot -p -c meminfo.plt meminfo.data 2
    ```

